<prompt id="reportPrompt" 
  title='举报原因:' 
  bind:getInput="reportPromptGetInput" 
  bind:modalCancel="reportPromptCancel"
  bind:modalConfirm="reportPromptConfirm"
  type="textarea"
  input_height="18"
  max_length="30">
</prompt>

<!-- 漂浮头部 -->
<view class="header-outer shadow">
  <view class="header"  wx:if="{{data_received}}">
    <view class="header-title">
      <text style="font-weight:bold;align-self:center">#{{postDetail.post_id}}</text>
      <view class="topic">{{postDetail.post_topic}}</view>
    </view>
    <view class="header-control">
      <!-- 围观/公开状态 -->
      <view class="header-status">
        <view class="status-active" wx:if="{{!postDetail.is_author && postDetail.is_following}}" bindtap="follow">
          正在围观
        </view>
        <view class="status-inactive" wx:if="{{!postDetail.is_author && !postDetail.is_following}}" bindtap="follow">
          尚未围观
        </view>  
        <view class="status-active" wx:if="{{postDetail.is_author && postDetail.post_public == '1'}}" bindtap="setPrivate">
          公开状态
        </view>    
        <view class="status-inactive" wx:if="{{postDetail.is_author && postDetail.post_public == '2'}}" bindtap="setPublic">
          私密状态
        </view> 
      </view>
      <!-- 更多操作 -->
      <view class="icon-more-outer" bindtap="showMainMenu">
        <image class="icon-more" src="/images/more.svg"></image>
      </view> 
    </view>
  </view>
</view>

<scroll-view
  scroll-y="{{true}}" class="scroll-outer"
  refresher-enabled="{{true}}"
  refresher-threshold="{{30}}"
  refresher-default-style="{{scrollViewRefresherStyle}}"
  refresher-triggered="{{triggered}}"
  bindrefresherrefresh="onRefresh"
  bindrefresherrestore="onRestore"
>
  <view class="content-outer" wx-if="{{data_received}}">
    <!-- 内容 -->
    <view class="post-outer">
      <view class="post-content">
        <view class="post-text">
          <text user-select='true'>{{postDetail.post_msg}}</text>        
        </view>
        <!-- 图片 -->
        <view wx:if="{{postDetail.post_image != ''}}" style="margin-top: 5vw;text-align:center">
          <image
            style="width:100%;border-radius: 10px" mode="widthFix"
            src="{{postDetail.post_image}}"
            bindtap="previewPic"
          ></image>
        </view>
      </view>
      <!-- 日期 -->
      <view class="post-datetime">
        <text>发表于{{postDetail.post_date}}</text>
      </view>
      <!-- 署名 -->
      <view class="alias" bindtap="visitUser">
        <text>{{postDetail.post_alias}}</text>
      </view>
      <view class="avatar-outer" bindtap="visitUser">
        <image class="avatar" src="{{preURL+postDetail.user_avatar+'.svg'}}"/>
      </view>
    </view>

    <!-- 展示评论 -->
    <view class="comment-area" wx-if="{{data_received}}">
      <!-- 显示评论数和围观数 -->
      <view class="comment-follower-num-area">
        <!-- 评论数 -->
        <view class="comment-icon-outer">
          <image class="icon" src="/images/comment.svg"></image> 
        </view>
        <view class="comment-num">
          <text>{{postDetail.comment_num}}</text>
        </view>
        <!-- 围观数 -->
        <view class="follower-icon-outer">
          <image wx-if="{{postDetail.is_following}}" bindtap="follow" class="icon" src="/images/star-active.svg"></image> 
          <image wx-if="{{!postDetail.is_following}}" bindtap="follow" class="icon" src="/images/star-inactive.svg"></image> 
        </view>   
        <view class="follower-num">{{postDetail.follower_num}}</view>
        <!-- 分享按钮 -->
        <view class="share-icon-outer">
          <button open-type="share"><image class="icon" src="/images/share.svg"></image></button>
        </view>
        <!-- 倒序 -->
        <view bindtap="reverseComments" style="width: 100%; margin-right: 5vw" wx:if="{{commentList.length > 0}}">
          <view style="text-align: right">
            <image wx:if="{{!comment_reverse}}" class="icon" src="/images/sort.svg"></image>
            <image wx:if="{{comment_reverse}}" class="icon" style="transform: rotate(180deg)" src="/images/sort.svg"></image>
          </view>
        </view>
      </view>
      <!-- 显示所有评论 -->
      <view>
        <singleComment
          id="commentComponent"
          wx:for="{{commentList}}" wx:key="index" 
          bind:deleteComment="deleteComment"
          bind:replyComment="replyComment"
          bind:reportComment="reportComment"
          post_serial="{{post_serial}}"
          comment_id="{{item.comment_id}}"
          comment_order="{{item.comment_order}}"
          comment_msg="{{item.comment_msg}}"
          comment_date="{{item.comment_date}}"
          is_author="{{item.is_author}}"
          is_anonymous="{{item.is_anonymous}}"
          comment_alias="{{item.comment_alias}}"
          user_avatar="{{item.user_avatar}}"
          user_serial="{{item.user_serial}}"
          post_is_author="{{postDetail.is_author}}"
          />
      </view>
    </view>
  </view>
</scroll-view>

<!-- 追加补充信息 -->
<view bindtap="goToComment">
  <view class="comment-content-outer">
    <view>{{comment_placeholder}}</view>
    <image class="icon-send" src="/images/thought.svg"></image>
  </view>
</view>