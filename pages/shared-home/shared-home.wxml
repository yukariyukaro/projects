<view wx:if="{{!is_error}}">
<wxs src="../../utils/indexOf.wxs" module="tools" />
<navbar items="{{navItems}}" start-index="-2" model:current-index="{{currentTab}}" bind:change="navbarTap" />

<view class="write-button-outer" bind:tap="handleWriteTap">
  <view class="write-button-inner">
  <image class="write-button" src="/images/send-post.svg"></image>    
  </view>
</view>

<scroll-view
  scroll-y="{{true}}" class="scroll-outer"
  scroll-top="{{scroll_top}}"
  enable-back-to-top="{{true}}"
  refresher-enabled="{{true}}"
  refresher-threshold="{{30}}"
  refresher-default-style="{{scrollViewRefresherStyle}}"
  refresher-triggered="{{refresh_triggered}}"
  bindrefresherrefresh="onRefresh"
  bindrefresherrestore="onRestore"
  bindscrolltolower="onLoadMore"
>
  <view class="tool-bar" hidden="{{!main_data_received}}">
    <navigator class="search-outer" url="/pages/shared-search/shared-search">
      <image class="search-icon" src="/images/search.svg"></image>
      <view>探寻Uni树洞</view>
    </navigator>
  </view>

  <view class="post-content" hidden="{{currentTab!==-2||!main_data_received}}">
    <pinned
      posts="{{pinned}}"
    />
    <singlePost wx:for="{{posts}}" wx:key="id" wx:if="{{item.post_serial !== '999999'}}"
      post_serial="{{item.post_serial}}" 
      topic_label="{{item.topic_label}}" 
      comment_num="{{item.comment_num}}" 
      post_msg="{{item.post_msg}}" 
      follower_num="{{item.follower_num}}" 
      is_following="{{tools.indexOf(following_posts,item.post_serial)}}"
      post_is_complete="{{item.post_is_complete}}"
      user_avatar="{{item.user_avatar}}"
      music_player="{{item.music_player}}"
      music_title="{{item.music_title}}"
      music_source="{{item.music_source}}"
      pic="{{item.pic}}"
      union/>
    <loadmore end="{{main_no_more_post}}" loading="{{is_loading_more}}" />
  </view>
  <view class="post-content" hidden="{{currentTab!==-1}}">
    <singlePost  wx:for="{{hotPosts}}" wx:key="id"
      post_serial="{{item.post_serial}}" 
      topic_label="{{item.topic_label}}" 
      comment_num="{{item.comment_num}}" 
      post_msg="{{item.post_msg}}" 
      follower_num="{{item.follower_num}}" 
      is_following="{{tools.indexOf(following_posts,item.post_serial)}}"
      post_is_complete="{{item.post_is_complete}}"
      user_avatar="{{item.user_avatar}}"
      music_player="{{item.music_player}}"
      music_title="{{item.music_title}}"
      music_source="{{item.music_source}}"
      pic="{{item.pic}}"
      union/>
    <loadmore end="{{hot_no_more_post}}" loading="{{is_loading_more}}" />
  </view>
  <view class="post-content" hidden="{{currentTab!==0}}">
    <singlePost  wx:for="{{mine_posts}}" wx:key="id"
      post_serial="{{item.post_serial}}" 
      topic_label="{{item.topic_label}}" 
      comment_num="{{item.comment_num}}" 
      post_msg="{{item.post_msg}}" 
      follower_num="{{item.follower_num}}" 
      is_following="{{false}}"
      post_is_complete="{{item.post_is_complete}}"
      user_avatar="{{item.user_avatar}}"
      music_player="{{item.music_player}}"
      music_title="{{item.music_title}}"
      music_source="{{item.music_source}}"
      pic="{{item.pic}}"
      union/>
    <loadmore empty="{{mine_posts.length==0}}" end="{{mine_no_more_post}}" loading="{{is_loading_more}}">
      <text>这里空荡荡的\n快写下自己树洞吧</text>
    </loadmore>
  </view>
  <view class="post-content" hidden="{{currentTab!==1}}">
    <singlePost  wx:for="{{following_posts}}" wx:key="id"
      post_serial="{{item.post_serial}}" 
      topic_label="{{item.topic_label}}" 
      comment_num="{{item.comment_num}}" 
      post_msg="{{item.post_msg}}" 
      follower_num="{{item.follower_num}}" 
      is_following="{{false}}"
      post_is_complete="{{item.post_is_complete}}"
      user_avatar="{{item.user_avatar}}"
      music_player="{{item.music_player}}"
      music_title="{{item.music_title}}"
      music_source="{{item.music_source}}"
      pic="{{item.pic}}"
      union/>
    <loadmore empty="{{following_posts.length==0}}" end="{{following_no_more_post}}" loading="{{is_loading_more}}">
      <text>这里空荡荡的~\n*点击树洞详情页的右上角\n可以开始围观感兴趣的树洞</text>
    </loadmore>
  </view>
</scroll-view>


</view>

<view wx:if="{{is_error}}">
  <view style="font-size: 50rpx;font-weight: bold;text-align: center;margin-top: 100rpx;margin-bottom: 50rpx;">{{error_title}}</view>
  <view style="font-size: 34rpx;margin-left: 30rpx;margin-right: 30rpx;">{{error_content}}</view>
</view>